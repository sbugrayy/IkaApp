<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Receiver</title>
<style>video{width:640px;max-width:100%;}</style>
</head>
<body>
<h2>Alıcı WebRTC</h2>
<video id="remoteVideo" autoplay playsinline></video>
<br>
<button id="recordBtn">Kaydı Başlat/Durdur</button>
<p id="status"></p>
<script>
let pc = new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});
let ws = new WebSocket("ws://SIGNALING_SERVER_IP:8765"); // server IP değiştir
const remoteVideo = document.getElementById("remoteVideo");
const btn = document.getElementById("recordBtn");
const statusEl = document.getElementById("status");
let mediaRecorder, chunks=[];

pc.ontrack = e => { remoteVideo.srcObject = e.streams[0]; statusEl.textContent="Remote stream geldi."; };
pc.onicecandidate = e => { if(e.candidate) ws.send(JSON.stringify({candidate:e.candidate})); };

ws.onmessage = async msg => {
    const data = JSON.parse(msg.data);
    if(data.sdp){
        await pc.setRemoteDescription(new RTCSessionDescription(data.sdp));
        if(data.sdp.type==="offer"){
            const answer = await pc.createAnswer();
            await pc.setLocalDescription(answer);
            ws.send(JSON.stringify({sdp:pc.localDescription}));
        }
    }
    if(data.candidate){ await pc.addIceCandidate(data.candidate); }
};

// Kayıt butonu
btn.onclick = () => {
    if(!mediaRecorder || mediaRecorder.state==="inactive"){
        chunks=[];
        mediaRecorder = new MediaRecorder(remoteVideo.srcObject);
        mediaRecorder.ondataavailable=e=>{ if(e.data.size>0) chunks.push(e.data); };
        mediaRecorder.onstop=()=>{
            const blob=new Blob(chunks,{type:"video/webm"});
            const a=document.createElement("a");
            a.href=URL.createObjectURL(blob);
            a.download="remote_stream.webm";
            a.click();
            statusEl.textContent="Kayıt tamamlandı";
        };
        mediaRecorder.start(1000);
        statusEl.textContent="Kayıt başladı...";
        btn.textContent="Kaydı Durdur";
    }else{ mediaRecorder.stop(); btn.textContent="Kaydı Başlat/Durdur"; }
};
</script>
</body>
</html>
